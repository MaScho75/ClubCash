<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV mit Jspreadsheet bearbeiten</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jspreadsheet@4.8.0/dist/jspreadsheet.css" />
</head>
<body>
    <h1>CSV Daten bearbeiten</h1>
    <div id="spreadsheet"></div>
    <script src="https://cdn.jsdelivr.net/npm/jsuites@4.8.0/dist/jsuites.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspreadsheet@4.8.0/dist/jspreadsheet.js"></script>
    <script>
        const csvUrl = "daten/produkte.csv"; // Pfad zur CSV-Datei

        fetch(csvUrl)
            .then(response => response.text())
            .then(csv => {
                // CSV in ein Array von Zeilen und Spalten umwandeln
                const parsedData = csv.split("\n").map(row => row.split(";"));
                
                // Initialisiere das Jspreadsheet Spreadsheet
                const spreadsheet = jspreadsheet(document.getElementById('spreadsheet'), {
                    data: parsedData.slice(1),  // Entferne die Kopfzeile
                    columns: parsedData[0].map(header => ({ title: header })),  // Spaltenüberschriften
                    editable: true,              // Bearbeitung aktivieren
                    sortable: true,              // Sortieren aktivieren
                    search: true,                // Suche aktivieren
                    columnSorting: true,         // Spalten sortierbar machen
                    tableOverflow: true          // Tabelle kann scrollen, wenn sie groß ist
                });

                // Optional: CSV speichern (speichert die Daten in ein CSV-Format)
                function saveCSV() {
                    const data = spreadsheet.getData();
                    let csvContent = "data:text/csv;charset=utf-8,";

                    // CSV-Daten mit Semikolon trennen und hinzufügen
                    data.forEach((row, index) => {
                        let rowData = row.join(";");
                        csvContent += index < data.length ? rowData + "\n" : rowData;
                    });

                    // CSV-Datei herunterladen
                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement('a');
                    link.setAttribute('href', encodedUri);
                    link.setAttribute('download', 'produkte.csv');
                    link.click();
                }

                // Optional: Button für CSV speichern
                const saveButton = document.createElement('button');
                saveButton.textContent = 'CSV speichern';
                saveButton.onclick = saveCSV;
                document.body.appendChild(saveButton);
            })
            .catch(err => console.error('Fehler beim Laden der CSV:', err));
    </script>
</body>
</html>
