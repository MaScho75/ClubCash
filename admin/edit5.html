<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV in AG Grid - Bearbeiten und Speichern</title>

    <!-- AG-Grid CSS -->
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-grid.css">
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-theme-alpine.css">

    <!-- PapaParse (CSV Parser) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <!-- AG-Grid JavaScript (aktualisierte Version) -->
    <script src="https://unpkg.com/ag-grid-community@29.0.0/dist/ag-grid-community.min.noStyle.js"></script>
</head>
<body>

<h1>CSV Datei in AG Grid</h1>

<!-- AG-Grid Container -->
<div id="csvTable" style="height: 400px; width: 100%;" class="ag-theme-alpine"></div>

<!-- Button zum Speichern der bearbeiteten Daten -->
<button id="saveBtn" style="margin-top: 20px;">Daten speichern</button>

<script>
    const csvUrl = "daten/produkte.csv"; // Passe den Pfad zur CSV-Datei an

    // Funktion zum Laden und Parsen der CSV
    fetch(csvUrl)
        .then(response => response.text())
        .then(csv => {
            const parsedData = Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                delimiter: ";",  // CSV-Trennzeichen
                dynamicTyping: true
            });

            console.log("Parsed Daten:", parsedData);  // Zum Überprüfen der geparsten Daten

            // Spalten für AG-Grid definieren und editierbar machen
            const columnDefs = Object.keys(parsedData.data[0]).map(key => ({
                headerName: key,
                field: key,
                editable: true // Zellen bearbeitbar machen
            }));

            // AG-Grid Optionen
            const gridOptions = {
                columnDefs: columnDefs,
                rowData: parsedData.data,
                pagination: true,
                paginationPageSize: 10,
                defaultColDef: { resizable: true, flex: 1 },
                domLayout: 'autoHeight'
            };

            // AG-Grid initialisieren
            new agGrid.Grid(document.getElementById("csvTable"), gridOptions);

            // Speichern der bearbeiteten Daten
            document.getElementById('saveBtn').addEventListener('click', function() {
                const modifiedData = gridOptions.api.getDataAsCsv();
                const blob = new Blob([modifiedData], { type: 'text/csv' });

                // Erstellen eines Download-Links für die CSV-Datei
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'modified_data.csv'; // Name der gespeicherten Datei
                link.click();
            });
        })
        .catch(error => console.error("Fehler beim Laden der CSV:", error));
</script>

</body>
</html>
